window.wp=window.wp||{};(function(e,t){var n,r,i,s,o=Array.prototype.slice;r=function(e,t){var n=s(this,e,t);n.extend=this.extend;return n};i=function(){};s=function(e,n,r){var s;n&&n.hasOwnProperty("constructor")?s=n.constructor:s=function(){var t=e.apply(this,arguments);return t};t.extend(s,e);i.prototype=e.prototype;s.prototype=new i;n&&t.extend(s.prototype,n);r&&t.extend(s,r);s.prototype.constructor=s;s.__super__=e.prototype;return s};n={};n.Class=function(e,r,i){var s,o=arguments;if(e&&r&&n.Class.applicator===e){o=r;t.extend(this,i||{})}s=this;if(this.instance){s=function(){return s.instance.apply(s,arguments)};t.extend(s,this)}s.initialize.apply(s,o);return s};n.Class.applicator={};n.Class.prototype.initialize=function(){};n.Class.prototype.extended=function(e){var t=this;while(typeof t.constructor!="undefined"){if(t.constructor===e)return!0;if(typeof t.constructor.__super__=="undefined")return!1;t=t.constructor.__super__}return!1};n.Class.extend=r;n.Events={trigger:function(e){this.topics&&this.topics[e]&&this.topics[e].fireWith(this,o.call(arguments,1));return this},bind:function(e){this.topics=this.topics||{};this.topics[e]=this.topics[e]||t.Callbacks();this.topics[e].add.apply(this.topics[e],o.call(arguments,1));return this},unbind:function(e){this.topics&&this.topics[e]&&this.topics[e].remove.apply(this.topics[e],o.call(arguments,1));return this}};n.Value=n.Class.extend({initialize:function(e,n){this._value=e;this.callbacks=t.Callbacks();t.extend(this,n||{});this.set=t.proxy(this.set,this)},instance:function(){return arguments.length?this.set.apply(this,arguments):this.get()},get:function(){return this._value},set:function(e){var t=this._value;e=this._setter.apply(this,arguments);e=this.validate(e);if(null===e||this._value===e)return this;this._value=e;this.callbacks.fireWith(this,[e,t]);return this},_setter:function(e){return e},setter:function(e){var t=this.get();this._setter=e;this._value=null;this.set(t);return this},resetSetter:function(){this._setter=this.constructor.prototype._setter;this.set(this.get());return this},validate:function(e){return e},bind:function(){this.callbacks.add.apply(this.callbacks,arguments);return this},unbind:function(){this.callbacks.remove.apply(this.callbacks,arguments);return this},link:function(){var e=this.set;t.each(arguments,function(){this.bind(e)});return this},unlink:function(){var e=this.set;t.each(arguments,function(){this.unbind(e)});return this},sync:function(){var e=this;t.each(arguments,function(){e.link(this);this.link(e)});return this},unsync:function(){var e=this;t.each(arguments,function(){e.unlink(this);this.unlink(e)});return this}});n.Values=n.Class.extend({defaultConstructor:n.Value,initialize:function(e){t.extend(this,e||{});this._value={};this._deferreds={}},instance:function(e){return arguments.length===1?this.value(e):this.when.apply(this,arguments)},value:function(e){return this._value[e]},has:function(e){return typeof this._value[e]!="undefined"},add:function(e,t){if(this.has(e))return this.value(e);this._value[e]=t;t.parent=this;t.extended(n.Value)&&t.bind(this._change);this.trigger("add",t);this._deferreds[e]&&this._deferreds[e].resolve();return this._value[e]},create:function(e){return this.add(e,new this.defaultConstructor(n.Class.applicator,o.call(arguments,1)))},each:function(e,n){n=typeof n=="undefined"?this:n;t.each(this._value,function(t,r){e.call(n,r,t)})},remove:function(e){var t;if(this.has(e)){t=this.value(e);this.trigger("remove",t);t.extended(n.Value)&&t.unbind(this._change);delete t.parent}delete this._value[e];delete this._deferreds[e]},when:function(){var e=this,n=o.call(arguments),r=t.Deferred();t.isFunction(n[n.length-1])&&r.done(n.pop());t.when.apply(t,t.map(n,function(n){if(e.has(n))return;return e._deferreds[n]=e._deferreds[n]||t.Deferred()})).done(function(){var i=t.map(n,function(t){return e(t)});if(i.length!==n.length){e.when.apply(e,n).done(function(){r.resolveWith(e,i)});return}r.resolveWith(e,i)});return r.promise()},_change:function(){this.parent.trigger("change",this)}});t.extend(n.Values.prototype,n.Events);n.ensure=function(e){return typeof e=="string"?t(e):e};n.Element=n.Value.extend({initialize:function(e,r){var i=this,s=n.Element.synchronizer.html,o,u,a;this.element=n.ensure(e);this.events="";if(this.element.is("input, select, textarea")){this.events+="change";s=n.Element.synchronizer.val;if(this.element.is("input")){o=this.element.prop("type");n.Element.synchronizer[o]&&(s=n.Element.synchronizer[o]);if("text"===o||"password"===o)this.events+=" keyup"}else this.element.is("textarea")&&(this.events+=" keyup")}n.Value.prototype.initialize.call(this,null,t.extend(r||{},s));this._value=this.get();u=this.update;a=this.refresh;this.update=function(e){e!==a.call(i)&&u.apply(this,arguments)};this.refresh=function(){i.set(a.call(i))};this.bind(this.update);this.element.bind(this.events,this.refresh)},find:function(e){return t(e,this.element)},refresh:function(){},update:function(){}});n.Element.synchronizer={};t.each(["html","val"],function(e,t){n.Element.synchronizer[t]={update:function(e){this.element[t](e)},refresh:function(){return this.element[t]()}}});n.Element.synchronizer.checkbox={update:function(e){this.element.prop("checked",e)},refresh:function(){return this.element.prop("checked")}};n.Element.synchronizer.radio={update:function(e){this.element.filter(function(){return this.value===e}).prop("checked",!0)},refresh:function(){return this.element.filter(":checked").val()}};t.support.postMessage=!!window.postMessage;n.Messenger=n.Class.extend({add:function(e,t,r){return this[e]=new n.Value(t,r)},initialize:function(e,n){var r=window.parent==window?null:window.parent;t.extend(this,n||{});this.add("channel",e.channel);this.add("url",e.url||"");this.add("targetWindow",e.targetWindow||r);this.add("origin",this.url()).link(this.url).setter(function(e){return e.replace(/([^:]+:\/\/[^\/]+).*/,"$1")});this.receive=t.proxy(this.receive,this);this.receive.guid=t.guid++;t(window).on("message",this.receive)},destroy:function(){t(window).off("message",this.receive)},receive:function(e){var t;e=e.originalEvent;if(!this.targetWindow())return;if(this.origin()&&e.origin!==this.origin())return;if(typeof e.data!="string"||e.data[0]!=="{")return;t=JSON.parse(e.data);if(!t||!t.id||typeof t.data=="undefined")return;if((t.channel||this.channel())&&this.channel()!==t.channel)return;this.trigger(t.id,t.data)},send:function(e,t){var n;t=typeof t=="undefined"?null:t;if(!this.url()||!this.targetWindow())return;n={id:e,data:t};this.channel()&&(n.channel=this.channel());this.targetWindow().postMessage(JSON.stringify(n),this.origin())}});t.extend(n.Messenger.prototype,n.Events);n=t.extend(new n.Values,n);n.get=function(){var e={};this.each(function(t,n){e[n]=t.get()});return e};e.customize=n})(wp,jQuery);