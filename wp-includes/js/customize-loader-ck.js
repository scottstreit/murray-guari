/* global _wpCustomizeLoaderSettings */window.wp=window.wp||{};(function(e,t){var n=wp.customize,r;t.extend(t.support,{history:!!window.history&&!!history.pushState,hashchange:"onhashchange"in window&&(document.documentMode===undefined||document.documentMode>7)});r=t.extend({},n.Events,{initialize:function(){this.body=t(document.body);if(!r.settings||!t.support.postMessage||!t.support.cors&&r.settings.isCrossDomain)return;this.window=t(window);this.element=t('<div id="customize-container" />').appendTo(this.body);this.bind("open",this.overlay.show);this.bind("close",this.overlay.hide);t("#wpbody").on("click",".load-customize",function(e){e.preventDefault();r.link=t(this);r.open(r.link.attr("href"))});t.support.history&&this.window.on("popstate",r.popstate);if(t.support.hashchange){this.window.on("hashchange",r.hashchange);this.window.triggerHandler("hashchange")}},popstate:function(e){var t=e.originalEvent.state;t&&t.customize?r.open(t.customize):r.active&&r.close()},hashchange:function(){var e=window.location.toString().split("#")[1];e&&0===e.indexOf("wp_customize=on")&&r.open(r.settings.url+"?"+e);!e&&!t.support.history&&r.close()},open:function(e){var i;if(this.active)return;if(r.settings.browser.mobile)return window.location=e;this.active=!0;this.body.addClass("customize-loading");this.iframe=t("<iframe />",{src:e}).appendTo(this.element);this.iframe.one("load",this.loaded);this.messenger=new n.Messenger({url:e,channel:"loader",targetWindow:this.iframe[0].contentWindow});this.messenger.bind("ready",function(){r.messenger.send("back")});this.messenger.bind("close",function(){t.support.history?history.back():t.support.hashchange?window.location.hash="":r.close()});this.messenger.bind("activated",function(e){e&&(window.location=e)});i=e.split("?")[1];t.support.history&&window.location.href!==e?history.pushState({customize:e},"",e):!t.support.history&&t.support.hashchange&&i&&(window.location.hash="wp_customize=on&"+i);this.trigger("open")},opened:function(){r.body.addClass("customize-active full-overlay-active")},close:function(){if(!this.active)return;this.active=!1;this.trigger("close");this.link&&this.link.focus()},closed:function(){r.iframe.remove();r.messenger.destroy();r.iframe=null;r.messenger=null;r.body.removeClass("customize-active full-overlay-active").removeClass("customize-loading")},loaded:function(){r.body.removeClass("customize-loading")},overlay:{show:function(){this.element.fadeIn(200,r.opened)},hide:function(){this.element.fadeOut(200,r.closed)}}});t(function(){r.settings=_wpCustomizeLoaderSettings;r.initialize()});n.Loader=r})(wp,jQuery);