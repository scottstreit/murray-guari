/* global adminpage, wpActiveEditor, quicktagsL10n, wpLink, fullscreen, prompt *//*
 * Quicktags
 *
 * This is the HTML editor in WordPress. It can be attached to any textarea and will
 * append a toolbar above it. This script is self-contained (does not require external libraries).
 *
 * Run quicktags(settings) to initialize it, where settings is an object containing up to 3 properties:
 * settings = {
 *   id : 'my_id',          the HTML ID of the textarea, required
 *   buttons: ''            Comma separated list of the names of the default buttons to show. Optional.
 *                          Current list of default button names: 'strong,em,link,block,del,ins,img,ul,ol,li,code,more,close';
 * }
 *
 * The settings can also be a string quicktags_id.
 *
 * quicktags_id string The ID of the textarea that will be the editor canvas
 * buttons string Comma separated list of the default buttons names that will be shown in that instance.
 */// new edit toolbar used with permission
// by Alex King
// http://www.alexking.org/
function quicktags(e){return new QTags(e)}function edInsertContent(e,t){return QTags.insertContent(t)}function edButton(e,t,n,r,i){return QTags.addButton(e,t,n,r,i,"",-1)}var QTags,edCanvas,edButtons=[],edAddTag=function(){},edCheckOpenTags=function(){},edCloseAllTags=function(){},edInsertImage=function(){},edInsertLink=function(){},edInsertTag=function(){},edLink=function(){},edQuickLink=function(){},edRemoveTag=function(){},edShowButton=function(){},edShowLinks=function(){},edSpell=function(){},edToolbar=function(){};(function(){var e=function(t){var n,r,i,s;if(typeof jQuery!="undefined")jQuery(document).ready(t);else{n=e;n.funcs=[];n.ready=function(){if(!n.isReady){n.isReady=!0;for(r=0;r<n.funcs.length;r++)n.funcs[r]()}};n.isReady?t():n.funcs.push(t);if(!n.eventAttached){if(document.addEventListener){i=function(){document.removeEventListener("DOMContentLoaded",i,!1);n.ready()};document.addEventListener("DOMContentLoaded",i,!1);window.addEventListener("load",n.ready,!1)}else if(document.attachEvent){i=function(){if(document.readyState==="complete"){document.detachEvent("onreadystatechange",i);n.ready()}};document.attachEvent("onreadystatechange",i);window.attachEvent("onload",n.ready);s=function(){try{document.documentElement.doScroll("left")}catch(e){setTimeout(s,50);return}n.ready()};s()}n.eventAttached=!0}}},t=function(){var e=new Date,t;t=function(e){var t=e.toString();t.length<2&&(t="0"+t);return t};return e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"+00:00"}(),n;n=QTags=function(t){if(typeof t=="string")t={id:t};else if(typeof t!="object")return!1;var r=this,i=t.id,s=document.getElementById(i),o="qt_"+i,u,a,f;if(!i||!s)return!1;r.name=o;r.id=i;r.canvas=s;r.settings=t;if(i!=="content"||typeof adminpage!="string"||adminpage!=="post-new-php"&&adminpage!=="post-php")f=o+"_toolbar";else{edCanvas=s;f="ed_toolbar"}u=document.createElement("div");u.id=f;u.className="quicktags-toolbar";s.parentNode.insertBefore(u,s);r.toolbar=u;a=function(e){e=e||window.event;var t=e.target||e.srcElement,n=t.clientWidth||t.offsetWidth,u;if(!n)return;if(/ ed_button /.test(" "+t.className+" ")){r.canvas=s=document.getElementById(i);u=t.id.replace(o+"_","");r.theButtons[u]&&r.theButtons[u].callback.call(r.theButtons[u],t,s,r)}};u.addEventListener?u.addEventListener("click",a,!1):u.attachEvent&&u.attachEvent("onclick",a);r.getButton=function(e){return r.theButtons[e]};r.getButtonElement=function(e){return document.getElementById(o+"_"+e)};n.instances[i]=r;if(!n.instances[0]){n.instances[0]=n.instances[i];e(function(){n._buttonsInit()})}};n.instances={};n.getInstance=function(e){return n.instances[e]};n._buttonsInit=function(){var e=this,t,r,i,s,o,u,a,f,l,c,h=",strong,em,link,block,del,ins,img,ul,ol,li,code,more,close,";for(u in e.instances){if(u===0)continue;a=e.instances[u];t=a.canvas;r=a.name;i=a.settings;o="";s={};c="";i.buttons&&(c=","+i.buttons+",");for(l in edButtons){if(!edButtons[l])continue;f=edButtons[l].id;if(c&&h.indexOf(","+f+",")!==-1&&c.indexOf(","+f+",")===-1)continue;if(!edButtons[l].instance||edButtons[l].instance===u){s[f]=edButtons[l];edButtons[l].html&&(o+=edButtons[l].html(r+"_"))}}if(c&&c.indexOf(",fullscreen,")!==-1){s.fullscreen=new n.FullscreenButton;o+=s.fullscreen.html(r+"_")}if("rtl"===document.getElementsByTagName("html")[0].dir){s.textdirection=new n.TextDirectionButton;o+=s.textdirection.html(r+"_")}a.toolbar.innerHTML=o;a.theButtons=s}e.buttonsInitDone=!0};n.addButton=function(e,t,r,i,s,o,u,a){var f;if(!e||!t)return;u=u||0;i=i||"";if(typeof r=="function"){f=new n.Button(e,t,s,o,a);f.callback=r}else{if(typeof r!="string")return;f=new n.TagButton(e,t,r,i,s,o,a)}if(u===-1)return f;if(u>0){while(typeof edButtons[u]!="undefined")u++;edButtons[u]=f}else edButtons[edButtons.length]=f;this.buttonsInitDone&&this._buttonsInit()};n.insertContent=function(e){var t,n,r,i,s,o=document.getElementById(wpActiveEditor);if(!o)return!1;if(document.selection){o.focus();t=document.selection.createRange();t.text=e;o.focus()}else if(o.selectionStart||o.selectionStart===0){s=o.value;n=o.selectionStart;r=o.selectionEnd;i=o.scrollTop;o.value=s.substring(0,n)+e+s.substring(r,s.length);o.focus();o.selectionStart=n+e.length;o.selectionEnd=n+e.length;o.scrollTop=i}else{o.value+=e;o.focus()}return!0};n.Button=function(e,t,n,r,i){var s=this;s.id=e;s.display=t;s.access=n;s.title=r||"";s.instance=i||""};n.Button.prototype.html=function(e){var t=this.access?' accesskey="'+this.access+'"':"";return'<input type="button" id="'+e+this.id+'"'+t+' class="ed_button" title="'+this.title+'" value="'+this.display+'" />'};n.Button.prototype.callback=function(){};n.TagButton=function(e,t,r,i,s,o,u){var a=this;n.Button.call(a,e,t,s,o,u);a.tagStart=r;a.tagEnd=i};n.TagButton.prototype=new n.Button;n.TagButton.prototype.openTag=function(e,t){var n=this;t.openTags||(t.openTags=[]);if(n.tagEnd){t.openTags.push(n.id);e.value="/"+e.value}};n.TagButton.prototype.closeTag=function(e,t){var n=this,r=n.isOpen(t);r!==!1&&t.openTags.splice(r,1);e.value=n.display};n.TagButton.prototype.isOpen=function(e){var t=this,n=0,r=!1;if(e.openTags)while(r===!1&&n<e.openTags.length){r=e.openTags[n]===t.id?n:!1;n++}else r=!1;return r};n.TagButton.prototype.callback=function(e,t,n){var r=this,i,s,o,u,a=t.value,f,l,c,h,p=a?r.tagEnd:"";if(document.selection){t.focus();h=document.selection.createRange();if(h.text.length>0)r.tagEnd?h.text=r.tagStart+h.text+p:h.text=h.text+r.tagStart;else if(!r.tagEnd)h.text=r.tagStart;else if(r.isOpen(n)===!1){h.text=r.tagStart;r.openTag(e,n)}else{h.text=p;r.closeTag(e,n)}t.focus()}else if(t.selectionStart||t.selectionStart===0){i=t.selectionStart;s=t.selectionEnd;o=s;u=t.scrollTop;f=a.substring(0,i);l=a.substring(s,a.length);c=a.substring(i,s);if(i!==s)if(!r.tagEnd){t.value=f+c+r.tagStart+l;o+=r.tagStart.length}else{t.value=f+r.tagStart+c+p+l;o+=r.tagStart.length+p.length}else if(!r.tagEnd){t.value=f+r.tagStart+l;o=i+r.tagStart.length}else if(r.isOpen(n)===!1){t.value=f+r.tagStart+l;r.openTag(e,n);o=i+r.tagStart.length}else{t.value=f+p+l;o=i+p.length;r.closeTag(e,n)}t.focus();t.selectionStart=o;t.selectionEnd=o;t.scrollTop=u}else{if(!p)t.value+=r.tagStart;else if(r.isOpen(n)!==!1){t.value+=r.tagStart;r.openTag(e,n)}else{t.value+=p;r.closeTag(e,n)}t.focus()}};n.SpellButton=function(){};n.CloseButton=function(){n.Button.call(this,"close",quicktagsL10n.closeTags,"",quicktagsL10n.closeAllOpenTags)};n.CloseButton.prototype=new n.Button;n._close=function(e,t,n){var r,i,s=n.openTags;if(s)while(s.length>0){r=n.getButton(s[s.length-1]);i=document.getElementById(n.name+"_"+r.id);e?r.callback.call(r,i,t,n):r.closeTag(i,n)}};n.CloseButton.prototype.callback=n._close;n.closeAllTags=function(e){var t=this.getInstance(e);n._close("",t.canvas,t)};n.LinkButton=function(){n.TagButton.call(this,"link","link","","</a>","a")};n.LinkButton.prototype=new n.TagButton;n.LinkButton.prototype.callback=function(e,t,r,i){var s,o=this;if(typeof wpLink!="undefined"){wpLink.open();return}i||(i="http://");if(o.isOpen(r)===!1){s=prompt(quicktagsL10n.enterURL,i);if(s){o.tagStart='<a href="'+s+'">';n.TagButton.prototype.callback.call(o,e,t,r)}}else n.TagButton.prototype.callback.call(o,e,t,r)};n.ImgButton=function(){n.TagButton.call(this,"img","img","","","m")};n.ImgButton.prototype=new n.TagButton;n.ImgButton.prototype.callback=function(e,t,r,i){i||(i="http://");var s=prompt(quicktagsL10n.enterImageURL,i),o;if(s){o=prompt(quicktagsL10n.enterImageDescription,"");this.tagStart='<img src="'+s+'" alt="'+o+'" />';n.TagButton.prototype.callback.call(this,e,t,r)}};n.FullscreenButton=function(){n.Button.call(this,"fullscreen",quicktagsL10n.fullscreen,"f",quicktagsL10n.toggleFullscreen)};n.FullscreenButton.prototype=new n.Button;n.FullscreenButton.prototype.callback=function(e,t){if(!t.id||typeof fullscreen=="undefined")return;fullscreen.on()};n.TextDirectionButton=function(){n.Button.call(this,"textdirection",quicktagsL10n.textdirection,"",quicktagsL10n.toggleTextdirection)};n.TextDirectionButton.prototype=new n.Button;n.TextDirectionButton.prototype.callback=function(e,t){var n="rtl"===document.getElementsByTagName("html")[0].dir,r=t.style.direction;r||(r=n?"rtl":"ltr");t.style.direction="rtl"===r?"ltr":"rtl";t.focus()};edButtons[10]=new n.TagButton("strong","b","<strong>","</strong>","b");edButtons[20]=new n.TagButton("em","i","<em>","</em>","i"),edButtons[30]=new n.LinkButton,edButtons[40]=new n.TagButton("block","b-quote","\n\n<blockquote>","</blockquote>\n\n","q"),edButtons[50]=new n.TagButton("del","del",'<del datetime="'+t+'">',"</del>","d"),edButtons[60]=new n.TagButton("ins","ins",'<ins datetime="'+t+'">',"</ins>","s"),edButtons[70]=new n.ImgButton,edButtons[80]=new n.TagButton("ul","ul","<ul>\n","</ul>\n\n","u"),edButtons[90]=new n.TagButton("ol","ol","<ol>\n","</ol>\n\n","o"),edButtons[100]=new n.TagButton("li","li","	<li>","</li>\n","l"),edButtons[110]=new n.TagButton("code","code","<code>","</code>","c"),edButtons[120]=new n.TagButton("more","more","<!--more-->","","t"),edButtons[140]=new n.CloseButton})();