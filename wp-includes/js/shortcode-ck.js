// Utility functions for parsing and handling shortcodes in Javascript.
// Ensure the global `wp` object exists.
window.wp=window.wp||{};(function(){wp.shortcode={next:function(e,t,n){var r=wp.shortcode.regexp(e),i,s;r.lastIndex=n||0;i=r.exec(t);if(!i)return;if("["===i[1]&&"]"===i[7])return wp.shortcode.next(e,t,r.lastIndex);s={index:i.index,content:i[0],shortcode:wp.shortcode.fromMatch(i)};if(i[1]){s.match=s.match.slice(1);s.index++}i[7]&&(s.match=s.match.slice(0,-1));return s},replace:function(e,t,n){return t.replace(wp.shortcode.regexp(e),function(e,t,r,i,s,o,u,a){if(t==="["&&a==="]")return e;var f=n(wp.shortcode.fromMatch(arguments));return f?t+f+a:e})},string:function(e){return(new wp.shortcode(e)).string()},regexp:_.memoize(function(e){return new RegExp("\\[(\\[?)("+e+")(?![\\w-])([^\\]\\/]*(?:\\/(?!\\])[^\\]\\/]*)*?)(?:(\\/)\\]|\\](?:([^\\[]*(?:\\[(?!\\/\\2\\])[^\\[]*)*)(\\[\\/\\2\\]))?)(\\]?)","g")}),attrs:_.memoize(function(e){var t={},n=[],r,i;r=/(\w+)\s*=\s*"([^"]*)"(?:\s|$)|(\w+)\s*=\s*\'([^\']*)\'(?:\s|$)|(\w+)\s*=\s*([^\s\'"]+)(?:\s|$)|"([^"]*)"(?:\s|$)|(\S+)(?:\s|$)/g;e=e.replace(/[\u00a0\u200b]/g," ");while(i=r.exec(e))i[1]?t[i[1].toLowerCase()]=i[2]:i[3]?t[i[3].toLowerCase()]=i[4]:i[5]?t[i[5].toLowerCase()]=i[6]:i[7]?n.push(i[7]):i[8]&&n.push(i[8]);return{named:t,numeric:n}}),fromMatch:function(e){var t;e[4]?t="self-closing":e[6]?t="closed":t="single";return new wp.shortcode({tag:e[2],attrs:e[3],type:t,content:e[5]})}};wp.shortcode=_.extend(function(e){_.extend(this,_.pick(e||{},"tag","attrs","type","content"));var t=this.attrs;this.attrs={named:{},numeric:[]};if(!t)return;_.isString(t)?this.attrs=wp.shortcode.attrs(t):_.isEqual(_.keys(t),["named","numeric"])?this.attrs=t:_.each(e.attrs,function(e,t){this.set(t,e)},this)},wp.shortcode);_.extend(wp.shortcode.prototype,{get:function(e){return this.attrs[_.isNumber(e)?"numeric":"named"][e]},set:function(e,t){this.attrs[_.isNumber(e)?"numeric":"named"][e]=t;return this},string:function(){var e="["+this.tag;_.each(this.attrs.numeric,function(t){/\s/.test(t)?e+=' "'+t+'"':e+=" "+t});_.each(this.attrs.named,function(t,n){e+=" "+n+'="'+t+'"'});if("single"===this.type)return e+"]";if("self-closing"===this.type)return e+" /]";e+="]";this.content&&(e+=this.content);return e+"[/"+this.tag+"]"}})})();(function(){wp.html=_.extend(wp.html||{},{attrs:function(e){var t,n;"/"===e[e.length-1]&&(e=e.slice(0,-1));t=wp.shortcode.attrs(e);n=t.named;_.each(t.numeric,function(e){if(/\s/.test(e))return;n[e]=""});return n},string:function(e){var t="<"+e.tag,n=e.content||"";_.each(e.attrs,function(e,n){t+=" "+n;if(""===e)return;_.isBoolean(e)&&(e=e?"true":"false");t+='="'+e+'"'});if(e.single)return t+" />";t+=">";t+=_.isObject(n)?wp.html.string(n):n;return t+"</"+e.tag+">"}})})();