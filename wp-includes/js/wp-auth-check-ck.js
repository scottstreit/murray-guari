/* global adminpage */// Interim login dialog
(function(e){function r(){var n=e("#wp-auth-check"),r=e("#wp-auth-check-form"),s=t.find(".wp-auth-fallback-expired"),o,u=!1;if(r.length){e(window).on("beforeunload.wp-auth-check",function(e){e.originalEvent.returnValue=window.authcheckL10n.beforeunload});o=e('<iframe id="wp-auth-check-frame" frameborder="0">').attr("title",s.text());o.load(function(){var o,a;u=!0;try{a=e(this).contents().find("body");o=a.height()}catch(f){t.addClass("fallback");n.css("max-height","");r.remove();s.focus();return}if(o)a&&a.hasClass("interim-login-success")?i():n.css("max-height",o+40+"px");else if(!a||!a.length){t.addClass("fallback");n.css("max-height","");r.remove();s.focus()}}).attr("src",r.data("src"));e("#wp-auth-check-form").append(o)}t.removeClass("hidden");if(o){o.focus();setTimeout(function(){if(!u){t.addClass("fallback");r.remove();s.focus()}},1e4)}else s.focus()}function i(){e(window).off("beforeunload.wp-auth-check");typeof adminpage!="undefined"&&(adminpage==="post-php"||adminpage==="post-new-php")&&typeof wp!="undefined"&&wp.heartbeat&&wp.heartbeat.connectNow();t.fadeOut(200,function(){t.addClass("hidden").css("display","");e("#wp-auth-check-frame").remove()})}function s(){var e=parseInt(window.authcheckL10n.interval,10)||180;n=(new Date).getTime()+e*1e3}var t,n;e(document).on("heartbeat-tick.wp-auth-check",function(e,n){if("wp-auth-check"in n){s();!n["wp-auth-check"]&&t.hasClass("hidden")?r():n["wp-auth-check"]&&!t.hasClass("hidden")&&i()}}).on("heartbeat-send.wp-auth-check",function(e,t){(new Date).getTime()>n&&(t["wp-auth-check"]=!0)}).ready(function(){s();t=e("#wp-auth-check-wrap");t.find(".wp-auth-check-close").on("click",function(){i()})})})(jQuery);